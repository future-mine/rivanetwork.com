(function($) {
  $.fn.tableitems = function() {
    // GENERATE NEW ID
    function dec2hex (dec) {
      return dec.toString(16).padStart(2, "0")
    }
    function generateId (len) {
      var arr = new Uint8Array((len || 40) / 2)
      window.crypto.getRandomValues(arr)
      return Array.from(arr, dec2hex).join('')
    }
    
    var $tableitems = this;
    var $addTableItemOne = $tableitems.find(".addTableItemOne");
    var $addTableItemTwo = $tableitems.find(".addTableItemTwo");
    var $deleteTableItem = $tableitems.find(".deleteTableItem");

   $addTableItemOne.on("click", function() {
     var $data = $tableitems.find("tbody tr:eq(0)").clone(true).appendTo($tableitems);
     var $newID = generateId();
     $data.find("select").val("");
     $data.find("input").val("").attr("id", $newID);
     $data.find("label").attr("for", $newID);
     if ($paymentToolStatus == "TRUE") {
      $data.find(".payment-types").attr("method-id", $newID);
      $data.find(".payment-method").attr("methods", $newID);
     }
   });

    $addTableItemTwo.on("click", function() {
      var $data = $tableitems.find("tbody");
      var $newID = generateId();
      $data.append('<tr><td class="ml-2"><div data-toggle="dropimage" class="dropimage"><div class="di-thumbnail"><img src="" alt="Ön İzleme"></div><div class="di-select"><label for="' + $newID + '">Bir resim seçiniz veya buraya sürükleyiniz</label><input type="file" id="' + $newID + '" name="productPosters[]" accept="image/*"></div></div></td><td class="text-center align-middle"><button type="button" class="btn btn-danger btn-icon deleteTableItem"><span class="far fa-trash-alt"></span></button></td></tr>');
      
      var $dropimage = $('[data-toggle="dropimage"]');
      if ($dropimage.length) {
        $dropimage.each(function() {
          $(this).dropImage();
        });
      }
    });

    $deleteTableItem.on("click", function() {
      var $tableTR = $(this).closest("tr");
      var $tableTRCount = $tableitems.find("tbody tr").length;
      if ($tableTRCount > 1) {
        $tableTR.remove();
      } else {
        $tableTR.find("input").val("");
      }
    });
  }
}(jQuery));